<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn Data Web Data Connector</title>
    <script type="text/javascript" src="https://tableau.github.io/webdataconnector/libs/tableauwdc-2.3.0.js"></script>
    <script type="text/javascript" src="https://connectors.tableau.com/libs/tableauwdc-2.0.latest.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript">
        var linkedinConnector = tableau.makeConnector();

        linkedinConnector.init = function(initCallback) {
            // Initialize the connector (can store API Key and other settings here)
            if (tableau.phase == tableau.phaseEnum.interactivePhase) {
                if (tableau.connectionData) {
                    var connector = JSON.parse(tableau.connectionData);
                    $("#apiKey").val(connector.apiKey);
                }
            }
            initCallback();
        };

        linkedinConnector.getSchema = function(schemaCallback) {
            var cols = [
                { id: "id", alias: "ID", dataType: tableau.dataTypeEnum.string },
                { id: "urn", alias: "URN", dataType: tableau.dataTypeEnum.string },
                { id: "username", alias: "Username", dataType: tableau.dataTypeEnum.string },
                { id: "first_name", alias: "First Name", dataType: tableau.dataTypeEnum.string }
            ];

            var tableSchema = {
                id: "linkedinData",
                alias: "LinkedIn Data",
                columns: cols
            };

            schemaCallback([tableSchema]);
        };

        linkedinConnector.getData = function(table, doneCallback) {
            var apiKey = "8b2d55889bmshafe33f821c7a253p15f9bejsnd92ff5f9a206";
            var apiUrl = "https://linkedin-data-api.p.rapidapi.com/";
            var endpoint = "profile"; // Specify the actual LinkedIn data endpoint you want to use

            // Making the API call to the LinkedIn Data API
            fetch(apiUrl + endpoint, {
                method: 'GET',
                headers: {
                    "X-RapidAPI-Key": apiKey,
                    "X-RapidAPI-Host": "linkedin-data-api.p.rapidapi.com",
                    "Content-Type": "application/json"
                }
            })
            .then(response => response.json())
            .then(data => {
                // Process the data and map it to Tableau-friendly format
                var tableData = data.data.map(item => ({
                    id: item.id,
                    urn: item.urn,
                    username: item.username,
                    first_name: item.firstName
                }));

                // Append rows to Tableau's data table
                table.appendRows(tableData);
                doneCallback();
            })
            .catch(error => {
                console.error("Error fetching LinkedIn data: ", error);
                doneCallback();
            });
        };

        tableau.registerConnector(linkedinConnector);

        $(document).ready(function() {
            $("#input-form").on("submit", function(e) {
                e.preventDefault();
                if (this.checkValidity()) {
                    var data = {
                        apiKey: $("#apiKey").val()
                    };

                    tableau.connectionData = JSON.stringify(data);
                    tableau.connectionName = "LinkedIn Data"; // Set a name for the
